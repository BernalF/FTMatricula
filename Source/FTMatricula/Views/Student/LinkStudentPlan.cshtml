@model FTMatricula.Models.Student

@{
    Layout = "~/Views/Shared/_LayoutKendo.cshtml";
    ViewBag.Title = Resources.GetValue("STUDENT_MAINTENANCE");
}

@section styles {

}

<div id="content_edit_left">
    <div class="editMenuSpace">
        <div class="editMenu">
            <ul>
                <li class="editOptList">
                    <div class="editOpt">
                        <a href="@Url.Action("EditPD", "Student", routeValues: new { id = Model.StudentID })">@Resources.GetValue("PERSONAL_DATA")
                        </a>
                    </div>
                </li>
                <li class="editOptList">
                    <div class="editOpt">
                        <a href="@Url.Action("EditAD", "Student", routeValues: new { id = Model.StudentID })">@Resources.GetValue("ADITIONAL_DATA")
                        </a>
                    </div>
                </li>
                <li class="editOptList  hide">
                    <div class="editOpt">
                        <a href="#">@Resources.GetValue("ACADEMIC_INFORMATION")
                        </a>
                    </div>
                </li>
                <li class="editOptList editOptSelected">
                    <div class="editOpt">
                        <a href="@Url.Action("LinkStudentPlan", "Student", routeValues: new { id = Model.StudentID })">Vincular a Planes
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<div id="content_edit_right">

    <div class="editBox">
        <div class="editTitle">
            <span>@Resources.GetValue("EDIT_STUDENT_TITLE") -</span>Vincular Estudiantes a Planes
        </div>

        <div class="editDetail">
            <div id="LinkPC">
                <div class="leftSide">
                    <h3 class="title2">Planes sin Asignar</h3>
                    <div class="infoHolder">
                        <p class="padLess lined30">Escriba el nombre del plan para Filtrar</p>
                        <input id="filter1" class="input" type="text" />
                        <div class="usersHolderBox panel">
                            <ul id="sortable1" class="connectedSortable">
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="rightSide">
                    <h3 class="title2">Planes de un Estudiante</h3>
                    <div class="infoHolder">
                        <p class="padLess lined30">Escriba el nombre del plan para Filtrar</p>
                        <input id="filter2" class="input" type="text" />
                        <div class="usersHolderBox panel">
                            <ul id="sortable2" class="connectedSortable">
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
                <div class="errorsSpace">
                    <ul>
                        <li></li>
                    </ul>
                </div>
                <ul class="formBtnBar">
                    <li>
                        <a href="#" class="button send" id="btnLinkPS">@Resources.GetValue("SAVE")</a>
                    </li>
                    <li>
                        <a href="@Url.Action("Back", "Home", routeValues: new { opt = "programs" })" class="button back">@Resources.GetValue("CANCEL")</a>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</div>
@Html.HiddenFor(m => m.StudentID)

@section Scripts {
<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <script type="text/javascript">
        $(function () {
            // Enable drag a drop to the items list
            $('#sortable1, #sortable2').sortable({
                connectWith: '.connectedSortable'
            }).disableSelection();
            filteredList('filter1', 'sortable1');
            filteredList('filter2', 'sortable2');

            // Get the list of the Avalaible Courses
            $.bAjax({                
                url: '@Url.Action("GetPlans","Student")',
                data: { studentID: $('#StudentID').val() },
                async: false,
                ajaxSuccess: function (response) {
                    var robj = $.parseJSON(response);
                    buildCourseList(robj.PlanLeft, "#sortable1");
                    buildCourseList(robj.PlanRigth, "#sortable2");
                }
            });

            // Inject the course to the DOM
            function buildCourseList(data, obj) {
                if (data != "") {
                    var content = new StringBuilder();
                    $.each(data, function (key, val) {
                        content.append('<li><span id="');
                        content.append(val.PlanID);
                        content.append('">');
                        content.append(val.PlanName);
                        content.append('</span></li>');
                    });
                    $(obj).html(content.toString());
                }
                else {
                    $(obj).html("");
                }
            }

            // Save Action
            $('#btnLinkPS').off('click.btnLinkPS').on('click.btnLinkPS', function () {
                $.ajaxSettings.traditional = true;
                var lplans = [];
                $('#sortable2 li').each(function () {
                    lplans.push($(this).children('span').attr('id'));
                });
                $.bAjax({
                    url: '@Url.Action("InsertPlanStudent","Student")',
                    ajaxBeforeSend: function () {
                        $('.popupBg').fadeIn();
                        $('.loading').fadeIn();
                    },
                    data: { studentID: $('#StudentID').val(), plans: lplans },
                    datatype: "json",
                    async: false,
                    ajaxSuccess: function (response) {
                        $('.popupBg').fadeOut();
                        $('.loading').fadeOut();                        
                    }
                });
                return false;
            });
        });
    </script>
}
